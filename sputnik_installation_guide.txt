wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64/cuda-ubuntu1804.pin
sudo mv cuda-ubuntu1804.pin /etc/apt/preferences.d/cuda-repository-pin-600
sudo apt-key adv --fetch-keys https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64/7fa2af80.pub
sudo add-apt-repository "deb https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64/ /"
sudo apt-get update


sudo apt-get install cuda-toolkit-10-1

sudo apt-get install libgoogle-glog-dev

pip3 install --upgrade pip && pip install --upgrade tensorflow_gpu==2.3
pip install --upgrade tensor2tensor

sudo apt-get install -y software-properties-common
sudo apt-get update


wget -O - https://apt.kitware.com/keys/kitware-archive-latest.asc 2>/dev/null | gpg --dearmor - | sudo tee /etc/apt/trusted.gpg.d/kitware.gpg >/dev/null


sudo apt-add-repository 'deb https://apt.kitware.com/ubuntu/ bionic main'


sudo apt-get update && sudo apt-get install -y cmake

clone sputnik
cd sputnik/build


sudo cmake .. -DCMAKE_BUILD_TYPE=Release -DBUILD_TEST=OFF -DBUILD_BENCHMARK=OFF \
	-DCUDA_ARCHS="60;70" -DCMAKE_INSTALL_PREFIX=/usr/local/sputnik && \
	sudo make -j8 install


cd sgk/build

cmake .. -DCMAKE_BUILD_TYPE=Release -DCUDA_ARCHS="60;70" \
	-DCMAKE_INSTALL_PREFIX=/usr/local/sgk && \
	sudo make -j8 install


export LD_LIBRARY_PATH=/usr/local/cuda-10.2/lib64${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}}
#export LD_LIBRARY_PATH="`python3 -c 'import tensorflow as tf; print(tf.sysconfig.get_lib())'`:${LD_LIBRARY_PATH}"
export LD_LIBRARY_PATH="/usr/local/sputnik/lib:${LD_LIBRARY_PATH}"